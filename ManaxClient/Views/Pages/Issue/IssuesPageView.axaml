<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:previews="clr-namespace:ManaxClient.Controls.Previews"
    xmlns:issue="clr-namespace:ManaxClient.Models.Issue"
    xmlns:page="clr-namespace:ManaxClient.ViewModels.Pages.Issue"
    xmlns:viewModels="clr-namespace:ManaxClient.ViewModels"
    xmlns:localization="clr-namespace:Jeek.Avalonia.Localization;assembly=Jeek.Avalonia.Localization"
    mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
    x:Class="ManaxClient.Views.Pages.Issue.IssuesPageView"
    x:DataType="page:IssuesPageViewModel"
    IsVisible="{Binding $parent[Window].((viewModels:MainWindowViewModel)DataContext).CanReadAllIssues}">

    <UserControl.Resources>
        <DataTemplate x:Key="AutomaticChapterIssueTemplate" DataType="issue:IssueChapterAutomatic">
            <previews:IssuePreview IssueColor="#DC3545"
                                   BadgeText="{Binding AutomaticBadgeText}"
                                   Closable="False"
                                   Margin="0,0,0,8"
                                   Command="{Binding $parent[UserControl].((page:IssuesPageViewModel)DataContext).OnChapterIssueClicked}"
                                   CommandParameter="{Binding Chapter}">
                <previews:IssuePreview.Problem>
                    <MultiBinding StringFormat="{}{0}">
                        <Binding Path="Problem" />
                    </MultiBinding>
                </previews:IssuePreview.Problem>
                <previews:IssuePreview.Info>
                    <Binding Path="FormattedInfo" />
                </previews:IssuePreview.Info>
            </previews:IssuePreview>
        </DataTemplate>

        <DataTemplate x:Key="AutomaticSerieIssueTemplate" DataType="issue:IssueSerieAutomatic">
            <previews:IssuePreview IssueColor="#DC3545"
                                   BadgeText="{Binding AutomaticBadgeText}"
                                   Closable="False"
                                   Margin="0,0,0,8"
                                   Command="{Binding $parent[UserControl].((page:IssuesPageViewModel)DataContext).OpenSeriePage}"
                                   CommandParameter="{Binding Serie}">
                <previews:IssuePreview.Problem>
                    <MultiBinding StringFormat="{}{0}">
                        <Binding Path="Problem" />
                    </MultiBinding>
                </previews:IssuePreview.Problem>
                <previews:IssuePreview.Info>
                    <Binding Path="FormattedInfo" />
                </previews:IssuePreview.Info>
            </previews:IssuePreview>
        </DataTemplate>

        <DataTemplate x:Key="ReportedChapterIssueTemplate" DataType="issue:IssueChapterReported">
            <previews:IssuePreview IssueColor="#FD7E14"
                                   BadgeText="{localization:Localize IssuesPage.Reported}"
                                   Closable="True"
                                   Problem="{Binding Problem.Name}"
                                   Margin="0,0,0,8"
                                   CloseCommand="{Binding Close}"
                                   Command="{Binding $parent[UserControl].((page:IssuesPageViewModel)DataContext).OnChapterIssueClicked}"
                                   CommandParameter="{Binding Chapter}">
                <previews:IssuePreview.Info>
                    <Binding Path="FormattedInfo" />
                </previews:IssuePreview.Info>
            </previews:IssuePreview>
        </DataTemplate>

        <DataTemplate x:Key="ReportedSerieIssueTemplate" DataType="issue:IssueSerieReported">
            <previews:IssuePreview IssueColor="#FD7E14"
                                   BadgeText="{localization:Localize IssuesPage.Reported}"
                                   Closable="True"
                                   Problem="{Binding Problem.Name}"
                                   Margin="0,0,0,8"
                                   CloseCommand="{Binding Close}"
                                   Command="{Binding $parent[UserControl].((page:IssuesPageViewModel)DataContext).OpenSeriePage}"
                                   CommandParameter="{Binding Serie}">
                <previews:IssuePreview.Info>
                    <Binding Path="FormattedInfo" />
                </previews:IssuePreview.Info>
            </previews:IssuePreview>
        </DataTemplate>
    </UserControl.Resources>

    <ScrollViewer>
        <StackPanel Margin="24" Spacing="24">
            <TextBlock Text="{localization:Localize IssuesPage.Title}"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="#212529" />

            <StackPanel Orientation="Horizontal" Spacing="16">
                <ToggleButton x:Name="AutomaticToggle"
                              Content="{localization:Localize IssuesPage.Automatic}"
                              IsChecked="{Binding ShowAutomaticIssues}"
                              Padding="12,8"
                              CornerRadius="8"
                              Background="#E9ECEF"
                              Foreground="#495057"
                              BorderThickness="0" />

                <ToggleButton x:Name="ReportedToggle"
                              Content="{localization:Localize IssuesPage.Reported}"
                              IsChecked="{Binding !ShowAutomaticIssues}"
                              Padding="12,8"
                              CornerRadius="8"
                              Background="#E9ECEF"
                              Foreground="#495057"
                              BorderThickness="0" />

                <Border Width="1" Height="24" Background="#DEE2E6" VerticalAlignment="Center" />

                <ToggleButton x:Name="ChapterToggle"
                              Content="{localization:Localize IssuesPage.Chapters}"
                              IsChecked="{Binding ShowChapterIssues}"
                              Padding="12,8"
                              CornerRadius="8"
                              Background="#E9ECEF"
                              Foreground="#495057"
                              BorderThickness="0" />

                <ToggleButton x:Name="SerieToggle"
                              Content="{localization:Localize IssuesPage.Series}"
                              IsChecked="{Binding !ShowChapterIssues}"
                              Padding="12,8"
                              CornerRadius="8"
                              Background="#E9ECEF"
                              Foreground="#495057"
                              BorderThickness="0" />
            </StackPanel>

            <StackPanel Spacing="16">
                <StackPanel IsVisible="{Binding ShowAutomaticIssues}">
                    <StackPanel IsVisible="{Binding ShowChapterIssues}" Spacing="12">
                        <TextBlock Text="{localization:Localize IssuesPage.AutomaticChapters}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#495057" />

                        <ItemsControl ItemsSource="{Binding IssueChapterAutomatic}"
                                      ItemTemplate="{StaticResource AutomaticChapterIssueTemplate}" />

                        <TextBlock Text="{localization:Localize IssuesPage.NoAutomaticChapter}"
                                   FontStyle="Italic"
                                   Foreground="#6C757D"
                                   IsVisible="{Binding IssueChapterAutomatic.Count, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                    </StackPanel>

                    <StackPanel IsVisible="{Binding !ShowChapterIssues}" Spacing="12">
                        <TextBlock Text="{localization:Localize IssuesPage.AutomaticSeries}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#495057" />

                        <ItemsControl ItemsSource="{Binding IssueSerieAutomatic}"
                                      ItemTemplate="{StaticResource AutomaticSerieIssueTemplate}" />

                        <TextBlock Text="{localization:Localize IssuesPage.NoAutomaticSeries}"
                                   FontStyle="Italic"
                                   Foreground="#6C757D"
                                   IsVisible="{Binding IssueSerieAutomatic.Count, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                    </StackPanel>
                </StackPanel>

                <StackPanel IsVisible="{Binding !ShowAutomaticIssues}">
                    <StackPanel IsVisible="{Binding ShowChapterIssues}" Spacing="12">
                        <TextBlock Text="{localization:Localize IssuesPage.ReportedChapters}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#495057" />

                        <ItemsControl ItemsSource="{Binding IssueChapterReported}"
                                      ItemTemplate="{StaticResource ReportedChapterIssueTemplate}" />

                        <TextBlock Text="{localization:Localize IssuesPage.NoReportedChapter}"
                                   FontStyle="Italic"
                                   Foreground="#6C757D"
                                   IsVisible="{Binding IssueChapterReported.Count, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                    </StackPanel>

                    <StackPanel IsVisible="{Binding !ShowChapterIssues}" Spacing="12">
                        <TextBlock Text="{localization:Localize IssuesPage.ReportedSeries}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#495057" />

                        <ItemsControl ItemsSource="{Binding IssueSerieReported}"
                                      ItemTemplate="{StaticResource ReportedSerieIssueTemplate}" />

                        <TextBlock Text="{localization:Localize IssuesPage.NoReportedSeries}"
                                   FontStyle="Italic"
                                   Foreground="#6C757D"
                                   IsVisible="{Binding IssueSerieReported.Count, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>