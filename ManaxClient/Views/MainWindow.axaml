<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:ManaxClient.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:localization="clr-namespace:Jeek.Avalonia.Localization;assembly=Jeek.Avalonia.Localization"
    mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
    x:Class="ManaxClient.Views.MainWindow"
    x:DataType="vm:MainWindowViewModel"
    Icon="/Assets/avalonia-logo.ico"
    Title="{localization:Localize MainWindow.Title}"
    MinWidth="960"
    MinHeight="500"
    WindowStartupLocation="CenterScreen">

    <Panel>
        <Grid
            ColumnDefinitions="Auto,*">
            <ScrollViewer Grid.Column="0"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Hidden">
                <StackPanel Classes="sidebar"
                            IsVisible="{Binding CurrentPageViewModel.ControlBarVisible}"
                            Orientation="Vertical">

                    <TextBlock Classes="title"
                               Text="{localization:Localize MainWindow.Title}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,24" />

                    <Button Classes="sidebar primary"
                            Command="{Binding ChangePageHome}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="🏠" FontSize="16" />
                            <TextBlock Text="{localization:Localize MainWindow.Home}" />
                        </StackPanel>
                    </Button>

                    <Separator Margin="8,16" Background="{DynamicResource Background2}" />

                    <TextBlock Classes="subtitle"
                               Text="{localization:Localize MainWindow.Libraries}"
                               Margin="16,8" />

                    <ScrollViewer MaxHeight="300" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding Libraries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Classes="sidebar"
                                            Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ShowLibrary}"
                                            CommandParameter="{Binding }">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <TextBlock Text="📚" FontSize="14" />
                                            <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Spacing="2" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>

                    <Separator Margin="8,16" Background="{DynamicResource Background2}" IsVisible="{Binding IsAdmin}" />

                    <TextBlock Classes="subtitle"
                               Text="{localization:Localize MainWindow.Admin}"
                               Margin="16,8"
                               IsVisible="{Binding IsAdmin}" />

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadAllIssues}"
                            Command="{Binding ChangePageIssues}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="⚙️" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Issues}" />
                        </StackPanel>
                    </Button>

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadUsers}"
                            Command="{Binding ChangePageUsers}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="👥" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Users}" />
                        </StackPanel>
                    </Button>

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadRanks}"
                            Command="{Binding ChangePageRanks}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="🏆" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Ranks}" />
                        </StackPanel>
                    </Button>

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadTags}"
                            Command="{Binding ChangePageTags}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="🏆" FontSize="14" />
                            <TextBlock Text="Tags" />
                        </StackPanel>
                    </Button>

                    <TextBlock Classes="subtitle"
                               Text="{localization:Localize MainWindow.Parameters}"
                               Margin="16,8" />

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadServerSettings}"
                            Command="{Binding ChangePageSettings}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="⚙️" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Parameters.Server}" />
                        </StackPanel>
                    </Button>

                    <Button Classes="sidebar"
                            Command="{Binding ChangePageAppSettings}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="🎨" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Parameters.UI}" />
                        </StackPanel>
                    </Button>

                    <Separator Margin="8,16" Background="{DynamicResource Background2}" />

                    <TextBlock Classes="subtitle"
                               Text="{localization:Localize MainWindow.Stats}"
                               Margin="16,8" />

                    <Button Classes="sidebar"
                            Command="{Binding ChangePageUserStats}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="📊" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Stats.User}" />
                        </StackPanel>
                    </Button>

                    <Button Classes="sidebar"
                            IsVisible="{Binding CanReadServerStats}"
                            Command="{Binding ChangePageServerStats}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="🖥️" FontSize="14" />
                            <TextBlock Text="{localization:Localize MainWindow.Stats.Server}" />
                        </StackPanel>
                    </Button>

                    <Button
                        Classes="sidebar"
                        Command="{Binding Logout}"
                        Content="{localization:Localize MainWindow.Logout}"/>

                    <Border Classes="card"
                            Margin="8,16,8,8"
                            IsVisible="{Binding RunningTasks.Count}">
                        <StackPanel>
                            <TextBlock Classes="subtitle"
                                       Text="{localization:Localize MainWindow.RunningTasks}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,12" />

                            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding RunningTasks}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Classes="task-item">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <TextBlock Grid.Column="0"
                                                               Text="{Binding TaskName}"
                                                               TextWrapping="Wrap"
                                                               VerticalAlignment="Center" />
                                                    <Border Grid.Column="1"
                                                            Background="{StaticResource InfoBrush}"
                                                            CornerRadius="12"
                                                            Padding="8,4"
                                                            Margin="8,0,0,0">
                                                        <TextBlock Text="{Binding Number}"
                                                                   Foreground="{StaticResource TextColor1}"
                                                                   FontSize="12"
                                                                   FontWeight="Bold" />
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <Border Grid.Column="1"
                    Background="{DynamicResource Background1}">
                <ContentControl Content="{Binding CurrentPageViewModel}"
                                Margin="{Binding PageMargin}" />
            </Border>
        </Grid>

        <ContentControl HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center"
                        Content="{Binding Popup}" />

        <StackPanel Orientation="Vertical"
                    Spacing="8"
                    Margin="24"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom">
            <ItemsControl ItemsSource="{Binding Infos}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Classes="notification">
                            <TextBlock Text="{Binding .}"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       FontWeight="Medium" />
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </Panel>
</Window>